<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<title>Safe and Efficient Reinforcement Learning for Behavioural Planning in Autonomous Driving</title>

	<link rel="stylesheet" href="dist/reset.css">
	<link rel="stylesheet" href="dist/reveal.css">
	<link rel="stylesheet" href="dist/theme/black.css" id="theme">
	<link rel="stylesheet" href="css/custom.css">

	<!-- Theme used for syntax highlighted code -->
	<link rel="stylesheet" href="plugin/highlight/monokai.css" id="highlight-theme">


</head>
<body>
	<div class="reveal">
		<div class="slides">
			<section>
				<h4><span>Safe</span> and <span>Efficient</span> <br>Reinforcement Learning<br>for Behavioural Planning <br>in Autonomous Driving</h4>
				<p>
					<medium><a href="http://edouardleurent.com">Edouard Leurent</a></medium>
				</p>
				<p><small>Supervisors</small><hr>
					<small><a href="http://odalricambrymmaillard.neowordpress.fr/">Odalric-Ambrym Maillard</a>, <a href="http://researchers.lille.inria.fr/~efimov/">Denis Efimov</a>,<br><a href="http://researchers.lille.inria.fr/%7Eperruque/">Wilfrid Perruquetti</a>, <a href="https://fr.linkedin.com/in/yann-blanco-1038a717">Yann Blanco</a></small>
				</p>
				<p>Friday, October 30th 2020</p>
				<footer>
					<img data-src="images/inria.png" height="50">
					<img data-src="images/renault.png" height="50">
				</footer>
			</section>


			<section>
				<section>
					<header><h3>Introduction</h3></header>
				</section>
				<section>
					<header><h3>Motivation</h3></header>
					<ul>
						<li>Renault ADAS department</li>
						<li>ACC / LKA / AEB / AES</li>
					</ul>
				</section>
				<section>
					<header><h3>Failure modes</h3></header>
					<p>Access ramp</p>
				</section>
				<section>
					<header><h3>Failure modes</h3></header>
					<video data-autoplay muted loop controls data-src="videos/waymo.mp4" type="video/mp4"></video>
				</section>
				<section>
					<header><h3>Failure modes</h3></header>
					<video data-autoplay muted loop controls data-src="videos/navya_small.mp4" type="video/mp4"></video>
				</section>
				<section>
					<header><h3>Research questions</h3></header>
					<ul>
						<li class="fragment">How to <span class="green">smoothly</span> interact with other agents?</li>
						<li class="fragment">Can we guarantee <span class="red">safety</span>?</li>
					</ul>
				</section>
				<section>
					<header><h3>Benchmark: the <a href="http://github.com/eleurent/highway-env">highway-env</a> lib</h3></header>
					<div class="container">

						<div class="col">
							<img data-src="videos/highway-env/highway.gif" width="100%">
							<img data-src="videos/highway-env/roundabout-env.gif" width="80%">
							<img data-src="videos/highway-env/merge-env.gif" width="100%">
						</div>

						<div class="col">
							<img data-src="videos/highway-env/intersection-env.gif" width="70%">
							<img data-src="videos/highway-env/parking-env.gif" width="70%">
						</div>
					</div>
				</section>
				<section>
					<header><h3>Outline</h3></header>
					<ol>
						<li class="fragment">Model-based
							<ul>
								<li class="fragment" style="color:grey">Tree Search [ECML 2019, ACML 2020]</span></li>
								<li class="fragment">Robust RL [CDC 2019, CDC 2020, NeurIPS 2020]</li>
							</ul>
						</li>
						<li class="fragment">Model-free
							<ul>
								<li class="fragment">Social attention</li>
								<li class="fragment">Budgeted RL [NeurIPS 2019]</li>
							</ul>
						</li>
					</ol>
				</section>
			</section>


			<section>
				<section><h3>Model-based</h3></section>
				<section>
					<header><h3>Constrained optimization</h3></header>
					<video data-autoplay muted loop data-src="videos/robust/oracle.mp4" type="video/mp4"></video>
				</section>
				<section>
					<header><h3>Model Bias</h3></header>
					<video data-autoplay muted loop data-src="videos/robust/model-bias.mp4" type="video/mp4"></video>
				</section>
				<section>
					<header><h3>How to tackle model bias?</h3></header>
					<ol>
						<li class="fragment"> Build a confidence <strong>region</strong> for the dynamics
							\[\mathbb{P}\left[\color{orange}{\theta}\in\color{crimson}{\mathcal{C}_{N,\delta}}\right]\geq 1-\delta\]
						</li>
						<li class="fragment"> Plan <strong>robustly</strong> against the worst case outcome
							\[\color{limegreen}{\max_{\pi}} \color{crimson}{\inf_{\theta \in \mathcal{C}_{N,\delta}}} \bE \left[\sum_{t=0}^\infty \gamma^n R(x_t) \mid \color{crimson}{f_{\theta}}, \color{limegreen}{\pi}\right]\]
						</li>
					</ol>
				</section>
				<section>
					<header><h3>Confident regression</h3></header>
					<p class="fragment" align="left"> Assume $\color{orange}{f_\theta}$ is <strong>linearly</strong> parametrized<br>
					\[\small \color{orange}{f_\theta}(x, u) = \phi_0(x, u) + \sum_{i=1}^d \color{orange}{\theta_i}\phi_i(x, u)\in\Real^p\]</p>
					<p class="fragment theorem" align="left"> <strong>Proposition</strong>(Confidence ellipsoid $\color{crimson}{\cC_{N,\delta}}$) <!-- <em>W.h.p.</em>, -->
						\[\small \mathbb{P}\left[\|\color{orange}{\theta}-\color{crimson}{\theta_{N,\lambda}}\|_{G_{N,\lambda}} \leq \beta_N(\delta)\right]\geq 1-\delta\]
						$
						\scriptsize
						\begin{aligned}
						\theta_{N,\lambda} & = G_{N, \lambda}^{-1} \sum_{n=1}^N \Phi_n^\top \Sigma_p^{-1} y_n, & G_{N, \lambda} &= \sum_{n=1}^N \Phi_{n}^\top\Sigma_p^{-1}\Phi_{n}  + \lambda I_d
						\end{aligned}
						$
					</li>
				</section>
				<section>
					<header><h3>Robust planning</h3></header>
					<p>How to optimize the minimax objective?
						\[\color{limegreen}{\max_{\pi}} \color{crimson}{\inf_{\theta \in \mathcal{C}_{N,\delta}}} \bE \left[\sum_{t=0}^\infty \gamma^n R(x_t) \mid \color{crimson}{f_{\theta}}, \color{limegreen}{\pi}\right]\]
					</p>
					<p class="fragment" align="left">Related work</p>
					<ul>
						<li class="fragment">Robust Dynamic Programming <span class="fragment red">(finite $\mathcal{S}$)</span></li>
						<li class="fragment">Linear Quadratic Setting <span class="fragment">(<span class="green">continuous $\mathcal{S}$</span><!-- , <span class="fragment red">but...</span> -->)</span></li>
					</ul>
				</section>
				<section>
					<header><h3>Linear Quadratic Systems</h3></header>
					<div class="container">
						<div class="col">
							<p>
								<span class="fragment">$f(x, u) = Ax + Bu$</span>
								<span class="fragment">$R(x, u) = -x^\top Qx - u^\top R u$</span>
							</p>
							<p class="fragment"align="center">[Dean et al., 2019]<br>cast <span class="green">$\max$</span> <span class="red">$\min$</span> as an <span class="blue">SDP</span></p>
						</div>
						<div class="col fragment">
							<figure>
								<img data-src="images/robust/quadratic_w.png" width="55%">
								<figcaption><span class="red">stabilization</span> only</figcaption>
							</figure>
						</div>
					</div>
				</section>
				<section>
					<header><h3>Obstacle avoidance tasks</h3></header>
					<object data="images/robust/non-convex.svg" type="image/svg+xml" width="60%"
					height="60%"
					type="image/svg+xml"></object>
					<p>Require <span class="red">non-convex, non-smooth</span> rewards</p>
				</section>
				<section>
					<header><h3>Tree-based planning</h3></header>
					<div class="r-stack">
						<object class="fragment fade-in-then-out" data-fragment-index="0" data="images/robust/planning.svg" type="image/svg+xml" width="70%"
						height="80%"
						type="image/svg+xml"></object>
						<object class="fragment" data-fragment-index="1" data="images/robust/planning1.svg" type="image/svg+xml" width="70%"
						height="80%"
						type="image/svg+xml"></object>
					</div>
					<ul>
						<li class="fragment" data-fragment-index="0">Handle a <span class="red">single</span> known dynamics</li>
						<li class="fragment" data-fragment-index="1">Bound the set of <strong>reachable</strong> states under $\theta\in\cC_{N,\delta}$</li>
						<!-- <li class="fragment" data-fragment-index="2">Evaluate a <strong>worst-case</strong> reward</li> -->
					</ul>
				</section>
				<section>
					<header><h3>Interval Prediction</h3></header>
					<p align="left">Given $\theta\in\cC_{N,\delta}$, find \[\color{lightskyblue}{\underline x(t)} \leq x(t) \leq \color{lightskyblue}{\overline x(t)}\]</p>
					<p align="left" class="fragment"> <strong>Assumption</strong>: $f$ depends linearly on $x$
						\[
						\scriptsize
						\begin{aligned}
						\dot{{x}}(t) & = \color{orange}{A(\theta)}x(t) + Bu(t) + D\omega(t), \text{ where}\\
						\color{orange}{A(\theta)} & = A_0 + \sum_{i=1}^d\color{orange}{\theta_i}\phi_i \\
						\end{aligned}
					\]</p>
				</section>
				<section>
					<header><h3>Solution 1: interval arithmetic</h3></header>
					<p class="theorem" align="left"><strong>Lemma</strong> Given $\color{crimson}{\underline{A}\leq A(\theta)\leq\overline{A}}$ and $\color{lightskyblue}{\underline{x}(t)\leq x(t)\leq \overline{x}(t)}$,
						<span class="fragment">
							\[
							\scriptsize
							\begin{aligned}
							\dot{\underline{x}}(t) = \color{crimson}{\underline{A}^{+}}\color{lightskyblue}{\underline{x}^{+}(t)} - \color{crimson}{\overline{A}^{+}}\color{lightskyblue}{\underline{x}^{-}(t)} - \color{crimson}{\underline{A}^{-}}\color{lightskyblue}{\overline{x}^{+}(t)} + \color{crimson}{\overline{A}^{-}}\color{lightskyblue}{\overline{x}^{-}(t)} +Bu(t) + D^{+}\underline{\omega}(t)-D^{-}\overline{\omega}(t),\\
							\dot{\overline{x}}(t) = \color{crimson}{\overline{A}^{+}}\color{lightskyblue}{\overline{x}^{+}(t)} - \color{crimson}{\underline{A}^{+}}\color{lightskyblue}{\overline{x}^{-}(t)} - \color{crimson}{\overline{A}^{-}}\color{lightskyblue}{\underline{x}^{+}(t)} + \color{crimson}{\underline{A}^{-}}\color{lightskyblue}{\underline{x}^{-}(t)} +Bu(t) + D^{+}\overline{\omega}(t)-D^{-}\underline{\omega}(t),
							\end{aligned}
							\]
						</span>
						<span class="fragment">ensures the inclusion property.</span>
					</p>
				</section>
				<section>
					<header><h3>But is is stable?</h3></header>
					<p>$\dot x(t) = -\color{orange}{\theta} x(t) + \omega(t),
						\quad\left\{\begin{array}{l}
						\small \color{orange}{\theta\in[1, 2]}\\
						\small\omega(t) \in [-0.05, 0.05]
					\end{array}\right.$</p>
					<object class="fragment" data="images/robust/observer.svg" type="image/svg+xml" width="75%" type="image/svg+xml"></object>
				</section>
				<section style="font-size: .7em">
					<header><h3>Solution 2: polytopic structure</h3></header>
					<p align="left">Under polytopic uncertainty around <span class="red">$A_0$ Metzler</span> \[A(\theta) = \color{crimson}{A_0} + \sum_i\alpha_i\Delta A_i,\]</p>
					<p class="fragment theorem" align="left"> <strong>Theorem (CDC 2019)</strong> The predictor
						\[
						\scriptsize
						\begin{aligned}
						\dot{\underline{x}}(t) & = \color{crimson}{A_{0}}\underline{x}(t)-\Delta A_{+}\underline{x}^{-}(t)-\Delta A_{-}\overline{x}^{+}(t) +Bu(t)+D^{+}\underline{\omega}(t)-D^{-}\overline{\omega}(t),\\
						\dot{\overline{x}}(t) & = \color{crimson}{A_{0}}\overline{x}(t)+\Delta A_{+}\overline{x}^{+}(t)+\Delta A_{-}\underline{x}^{-}(t) +Bu(t)+D^{+}\overline{\omega}(t)-D^{-}\underline{\omega}(t), \\
						\end{aligned}
						\]
					ensures the inclusion property.</p>
					<!-- <aside id="references" class="references">[CDC 2019]</aside> -->
				</section>
				<section style="font-size: .7em">
					<header><h3>Solution 2: stability</h3></header>
					<p class="theorem" align="left"><strong>Theorem (CDC 2019)</strong>If there exist diagonal matrices $P$, $Q$, $Q_{+}$, $Q_{-}$, $Z_{+}$, $Z_{-}$, $\Psi_{+}$, $\Psi_{-}$, $\Psi$, $\Gamma\in\Real^{2n\times2n}$ such that
						<span class="fragment">
							\[
							\begin{aligned}
							\color{lightskyblue}{\Upsilon\preceq0},\;P+\min\{Z_{+},Z_{-}\}>0,\;\Gamma>0,\\
							Q+\min\{Q_{+},Q_{-}\}+2\min\{\Psi_{+},\Psi_{-}\}>0,
							\end{aligned}
							\]
						</span>
						<span class="fragment">
							where
							\[
							\Upsilon_{11}=\mathcal{A}^{\top}P+P\mathcal{A}+Q,\;\Upsilon_{12}=\mathcal{A}^{\top}Z_{+}+PR_{+}+\Psi_{+},\\
							\Upsilon_{13}=\mathcal{A}^{\top}Z_{-}+PR_{-}+\Psi_{-},\;\Upsilon_{22}=Z_{+}R_{+}+R_{+}^{\top}Z_{+}+Q_{+},\\
							\Upsilon_{23}=Z_{+}R_{-}+R_{+}^{\top}Z_{-}+\Psi,\;\Upsilon_{33}=Z_{-}R_{-}+R_{-}^{\top}Z_{-}+Q_{-},\\
							\mathcal{A}=\left[\begin{array}{cc}
							A_{0} & 0\\
							0 & A_{0}
							\end{array}\right],\;R_{+}=\left[\begin{array}{cc}
							0 & -\Delta A_{-}\\
							0 & \Delta A_{+}
							\end{array}\right],\;R_{-}=\left[\begin{array}{cc}
							\Delta A_{+} & 0\\
							-\Delta A_{-} & 0
							\end{array}\right]
							\]
						</span>
						<span class="fragment">
							then the predictor is <strong>input-to-state stable</strong> <em>w.r.t.</em> the disturbance $\underline{\omega}$, $\overline{\omega}$.
						</span>
					</p>
				</section>
				<section>
					<header><h3>Solution 2: stability</h3></header>
					<object data="images/robust/predictor.svg" type="image/svg+xml" width="75%" type="image/svg+xml"></object>
				</section>
				<section>
					<header><h3>Prediction for a car</h3></header>
					<figure>
						<img src="videos/interval/interval_direct.gif" width="50%">
						<figcaption>Simple predictor</figcaption>
					</figure>
					<figure>
						<img src="videos/interval/interval_novel.gif" width="50%">
						<figcaption>Enhanced predictor</figcaption>
					</figure>
				</section>
				<section>
					<header><h3>Minimax control</h3></header>
					<p>Use the predicted <strong>intervals</strong> in a <span class="orange">surrogate</span> objective
						\[\small
						\color{orange}{\hat{V}^r(u)} = \sum_{n=N+1}^\infty \gamma^n \color{orange}{\min_{\color{lightskyblue}{\underline{x}(t_n)}\leq x \leq\color{lightskyblue}{\overline{x}(t_n)}}  R(x)}
						\]
					</p>
					<p class="theorem fragment"><strong>Theorem (NeurIPS 2020)</strong>
						\[
						\small
						\color{orange}{\underbrace{\hat{V}^r(u)}_{\substack{\text{surrogate}\\\text{value}}}}
						\leq
						\color{crimson}{\underbrace{{V}^r(u)}_{\substack{\text{robust}\\\text{value}}}}
						\leq
						\color{limegreen}{\underbrace{{V}(u)}_{\substack{\text{true}\\\text{performance}}}}
						\]
					</p>
				</section>
				<section style="font-size: .7em">
					<header><h3>Bounded suboptimality</h3></header>
					<div class="theorem">
						<p align="left"><strong>Theorem (NeurIPS 2020)</strong> Under two conditions:
						<ol>
							<li class="fragment">Lipschitz reward $R$;</li>
							<li class="fragment">Stability condition: there exist $P>0,\,Q_0,\,\rho,\,N_0$ such that
							\[\forall \color{orange}{N}>N_0,\quad\begin{bmatrix}
								\color{orange}{A_N}^\top P + P \color{orange}{A_N} + Q_0 & P|D|  \\
								|D|^\top P & -\rho I_r \\
								\end{bmatrix}< 0;\]
							</li>
						</ol></p>
						<p align="left" class="fragment">with probability $1-\delta$,
							\[
							\underbrace{V(a_\star)}_{\substack{\text{optimal}\\ \text{performance}}} - \underbrace{V(a_K)}_{\substack{\text{true}\\ \text{performance}}} \leq
							\color{crimson}{\underbrace{\Delta_\omega}_{\substack{\text{robustness to}\\ \text{disturbances}}}} + \color{lightskyblue}{\underbrace{\mathcal{O}\left(\frac{\beta_N(\delta)^2}{\lambda_{\min}(G_{N,\lambda})}\right)}_{\text{estimation error}}} +
							\color{limegreen}{\underbrace{\mathcal{O}\left(K^{-\frac{\log 1/\gamma}{\log \kappa}}\right)}_{\text{planning error}}}
							\]
						</p>
					</div>
				</section>
				<section style="font-size: .7em">
					<header><h3>Asymptotic Near-optimality</h3></header>
					<div class="theorem">
						<p align="left"><strong>Corollary (NeurIPS 2020)</strong> Under an additional <strong>persistent excitation</strong> (PE) assumption:
							\[\exists \underline{\phi},\overline{\phi}>0: \forall n\geq n_0,\quad \underline{\phi}^2 \leq \lambda_{\min}(\Phi_{n}^\top\Sigma_{p}^{-1}\Phi_{n}) \leq \overline{\phi}^2,\]
							<span class="fragment" data-fragment-index="1">
							the stability condition 2. can be relaxed to its limit:
							$$\begin{bmatrix}
							\color{orange}{A(\theta)}^\top P + P \color{orange}{A(\theta)} + Q_0 & P|D|  \\
							|D|^\top P & -\rho I_r \\
							\end{bmatrix}< 0;$$
							</span>
							<span class="fragment" data-fragment-index="2">
							and the bound takes the more explicit form
							</span>
						</p>
						<p class="fragment" data-fragment-index="2">
							${V(a_\star)} - {V(a_K)} \leq
							\color{crimson}{\Delta_\omega} +$
							<span class="fragment shrink tiny" data-fragment-index="3">$\color{lightskyblue}{{\mathcal{O}\left(\frac{\log\left(N^{d/2}/\delta\right)}{N}\right)}}$</span>$ + $
							<span class="fragment shrink tiny" data-fragment-index="4">$\color{limegreen}{{\mathcal{O}\left(K^{-\frac{\log 1/\gamma}{\log \kappa}}\right)}}$</span>
						</p>
					</div>
				</section>
			</section>

			<section>
				<section><h3>Model-free</h3></section>
			</section>

		</div>
	</div>

	<script src="dist/reveal.js"></script>
	<script src="plugin/notes/notes.js"></script>
	<script src="plugin/search/search.js"></script>
	<script src="plugin/highlight/highlight.js"></script>
	<script src="plugin/math/math.js"></script>
	<script src="plugin/zoom/zoom.js"></script>
	<script>
		// More info about initialization & config:
		// - https://revealjs.com/initialization/
		// - https://revealjs.com/config/
		Reveal.initialize({
			hash: true,
			math: {
				mathjax: 'https://cdn.jsdelivr.net/gh/mathjax/mathjax@2.7.8/MathJax.js',
				config: 'TeX-AMS_HTML-full',
		      // pass other options into `MathJax.Hub.Config()`
		      TeX: { Macros: {
		      	Real: "{\\mathbb{R}}",
		      	cC: "{\\mathcal{C}}",
		      	bE: "{\\mathbb{E}}",
		      }}
		  },
			// Learn about plugins: https://revealjs.com/plugins/
			plugins: [ RevealSearch, RevealHighlight, RevealNotes, RevealMath, RevealZoom ]
		});
	</script>
</body>
</html>
